@using RoboticsWebsite.Models

@model CalendarViewModel

@{
    ViewBag.Title = "CalendarMaster";
    Layout = "~/Views/Shared/_Layout.cshtml";

    if (null == Session["CurrentMonth"])
    {
        //Session["CurrentMonth"] = DateTime.Now.Month;
        //Model.CurrentMonthNum = DateTime.Now.Month;
    }
    //Model.CurrentMonthNum = (int)Session["CurrentMonth"];
}

@using (Html.BeginForm())
{
    <div class="view-event-container" id="viewEvent">
        @Html.Partial("ViewEvent")
    </div>
    <div class="form-container" id="newEvent">
        <h5 class="form-header">Create New Event</h5>
        <table class="form-table">
            <tr>
                <td>Type: </td>
                <td>@Html.DropDownListFor(x => x.NewEvent.Type, Model.EventTypeSelectList, new { @class = "form-control" })</td>
            </tr>
            <tr>
                <td>Description: </td>
                <td><input type="text" name="NewEvent.Description" class="form-control" value=""/> </td>
            </tr>
            <tr>
                <td>Title: </td>
                <td><input type = "text" name = "NewEvent.Title" id="NewEvent.Title" class="form-control" value = "" /></td>
            </tr>
            <tr>
                <td>Start Time: </td>
                <td><input type="text" name="NewEvent.StartTimeString" class="form-control" /></td>
            </tr>
            <tr>
                <td>End Time: </td>
                <td><input type="text" name="NewEvent.EndTimeString" class="form-control" /></td>
            </tr>
            <tr>
                <td><input type="hidden" name="NewEvent.Day" id="formCurrentDay" /></td>
                <td><input type="number" name="CurrentMonthNum" value="@Model.CurrentMonthNum" hidden /></td>
            </tr>
            <tr>
                <td>
                    <input type="submit" id="submit" value="Submit" class="btn btn-sm" />
                </td>
                <td>
                    <button type="button" class="btn btn-sm" id="cancel" style="float: right">Cancel</button>
                </td>
            </tr>
        </table>
    </div>
}
<div>
@using (Html.BeginForm("PrevMonth", "Calendar"))
{
    <input type="number" name="CurrentMonthNum" value="@Model.CurrentMonthNum" style="visibility:hidden" />
    <input type="submit" class="btn btn-sm" id="prev-month" value="previous">
}
@using (Html.BeginForm("NextMonth", "Calendar"))
{
    <input type="number" name="CurrentMonthNum" value="@Model.CurrentMonthNum" style="visibility:hidden" />
    <input type="submit" class="btn btn-sm pull-top-right" id="next-month" value="next">
}
</div>
@for (int i = 1; i < 13; i++)
{
    //<h5></h5>
}
<h2>@Model.CurrentMonth</h2>

@*<div id="newEvent">@Html.Partial("NewEventDialog")</div>*@

<table class="table-days-header">
    <tr>
        @{
            string[] days = System.Globalization.DateTimeFormatInfo.CurrentInfo.DayNames;
            foreach (var day in days)
            {
                <td>@day</td>
            }
        }
    </tr>

</table>
<table class="table-bordered table-size-1">
    <tr class="table-size-row-1">
        @for (int i = 0; i < Model.NumDays + (int)Model.StartDay; i++)
        {
            while (i < (int)Model.StartDay)
            {
                <td></td>
                i++;
            }
            if (i % 7 == 0 && i != 0)
            {
                @Html.Raw("</tr>");
                @Html.Raw("<tr class=\"table-size-row-1\">");
            }
            <td class="pull-top-cell" id="">
                @{
                    Model.CurrentDay = (i + 1) - ((int)Model.StartDay);
                }

                @Html.Partial("Day")
            </td>
                    }
    </tr>
</table>
<div id="selectedDay" hidden></div>

<script type='text/javascript'>
    prevMonth = function () {
        @{
            //    if (Model.CurrentMonthNum == 1) {
            //        Session["CurrentMonth"] = 12;
            //    }
            //    else {
            Model.CurrentMonthNum--;
            //Session["CurrentMonth"] = Model.CurrentMonthNum --;

            //    }
        }
        location.reload(true);
    }

    nextMonth = function () {
        @{
            //if (Model.CurrentMonthNum == 12) {
            //  Session["CurrentMonth"] = 1;
            //}
            //else {
            //Model.CurrentMonthNum++;
            Session["CurrentMonth"] = Model.CurrentMonthNum ++;

            }
        
        location.reload(true);
    }

    $(document).ready(function () {

        $('#newEvent').prop("hidden", true);

        $('#viewEvent').prop("hidden", true);

        @*
        $('#prev-month').click(function () {
            @{
                    if (Model.CurrentMonthNum == 1) {
                        Session["CurrentMonth"] = 12;
                    }
                    else {
                        Session["CurrentMonth"] = Model.CurrentMonthNum --;
                    }
            }
            location.reload();
        });

        $('#next-month').click(function () {
            @{
                    if (Model.CurrentMonthNum == 12) {
                        Session["CurrentMonth"] = 1;
                    }
                    else {
                        Session["CurrentMonth"] = Model.CurrentMonthNum ++;
                    }
            }
            location.reload();
        });
*@
        /*$(".pull-top-cell").hover(
            function () {
                $(this).addClass("cell-hover");
            },
            function () {
                $(this).removeClass("cell-hover");
            }
            );*/

        //If a calendar item is clicked, shows all events for that day
        $(".calendar-table-2").click(function () {
            var cDay = this.id;
            var cDayP = cDay.split("|");
            $('#selectedDay').text(cDayP[0]);
            $('#viewEvent').prop("hidden", false);
        });

        $('.close-day-view').click(function () {
            $('#viewEvent').prop("hidden", true);
        });

        $(".myButton").click(function () {
            var cDay = this.id;
            $('#formCurrentDay').val(cDay);
            $('#newEvent').prop("hidden", false);
        });

        $('#cancel').click(function () {
            $('#newEvent').prop("hidden", true);
        });

        $("#startTimeDate").val("b");

        //$('#startTimeTextBox').datetimepicker();

        $("#startTimeDate").val("a");
    });

</script>



